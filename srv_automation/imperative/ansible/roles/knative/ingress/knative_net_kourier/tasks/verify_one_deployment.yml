---
- name: "Wait for Deployment {{ verify_deployment_name }} in namespace {{ verify_namespace }} to be Available"
  kubernetes.core.k8s_info:
    api_version: apps/v1
    kind: Deployment
    namespace: "{{ verify_namespace }}"
    name: "{{ verify_deployment_name }}"
  register: _dep
  until: >-
    (_dep.resources | length) > 0 and
    (
      (
        _dep.resources[0].status.conditions | default([])
        | selectattr('type', 'equalto', 'Available')
        | selectattr('status', 'equalto', 'True')
        | list
        | length
      ) > 0
    ) and
    (
      (_dep.resources[0].status.readyReplicas | default(0)) >= 1
    )
  retries: "{{ knative_net_kourier_verify_retries }}"
  delay: "{{ knative_net_kourier_verify_delay }}"
  changed_when: false

